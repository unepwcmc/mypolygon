function PanoramioMarker(opts){this.latlng=opts.latlng;if(!opts)opts={};this.offsetVertical_=-9;this.offsetHorizontal_=-9;this.height_=18;this.width_=18;this.image_information_=opts.image_information;}
PanoramioMarker.prototype=new GOverlay();PanoramioMarker.prototype.initialize=function(map){var me=this;var div=document.createElement("div");div.style.position="absolute";div.style.paddingLeft="0px";div.style.cursor='pointer';div.style.background="url('/images/sites/panoramio-marker.png') no-repeat 0 0";div.style.width="18px";div.style.height="18px";var hiddenDiv=document.createElement('div');hiddenDiv.style.position="absolute";hiddenDiv.style.display='none';hiddenDiv.style.bottom='25px';hiddenDiv.style.left='-'+(this.image_information_.width/2-5)+'px';hiddenDiv.style.width=(this.image_information_.width+8)+'px';hiddenDiv.style.height=(this.image_information_.height+8)+'px';hiddenDiv.style.background='#FFFFFF';hiddenDiv.alt=this.image_information_.slug;var arrow=document.createElement("img");arrow.style.position="absolute";arrow.style.bottom='-7px';arrow.style.left=(this.image_information_.width/2-4)+'px';arrow.style.width="16px";arrow.style.height="8px";arrow.style.border='none';arrow.src='/images/sites/arrow_tooltip_2.png';hiddenDiv.appendChild(arrow);var img_bkg=document.createElement('div');img_bkg.style.padding='4px 4px 1px';img_bkg.style.margin='0';img_bkg.style.height='0';img_bkg.style.font='bold 11px Arial';img_bkg.style.color='#FFFFFF';img_bkg.style.background="white";var img=document.createElement('img');img.style.width=(this.image_information_.width)+'px';img.style.height=(this.image_information_.height)+'px';$(img).attr('alt',this.image_information_.photo_url);$(img).attr('src',this.image_information_.url);img_bkg.appendChild(img);$(img).click(function(ev){window.open($(img).attr('alt'));});var close_button=document.createElement('a');close_button.style.position="absolute";close_button.style.right="-7px";close_button.style.top="-5px";close_button.style.padding='0';close_button.style.width='20px';close_button.style.height='23px';close_button.style.background="url('/images/sites/x.png') no-repeat 0 0";$(close_button).click(function(ev){click_panoramio_marker=false;setTimeout(function(){click_panoramio_marker=true;},200);ev.preventDefault();ev.stopPropagation();$(this).parent().trigger("close_image");});hiddenDiv.appendChild(close_button);hiddenDiv.appendChild(img_bkg);div.appendChild(hiddenDiv);GEvent.addDomListener(div,"click",function(event){event.stopPropagation();event.preventDefault();$(this).parent().trigger("close_image");$(this).parent().bind('close_image',function(){$(this).children('div').children('div').hide();});$(this).children('div').css('z-index',global_index+1);global_index++;$(this).children('div').show();});GEvent.addDomListener(div,"mouseover",function(event){$(this).css('z-index',global_index+1);global_index++;});map.getPane(G_MAP_FLOAT_PANE).appendChild(div);this.map_=map;this.div_=div;};PanoramioMarker.prototype.remove=function(){this.div_.parentNode.removeChild(this.div_);};PanoramioMarker.prototype.copy=function(){var opts={};opts.latlng=this.latlng;opts.image_information=this.image_information_;return new PanoramioMarker(opts);};PanoramioMarker.prototype.redraw=function(force){if(!force)return;var divPixel=this.map_.fromLatLngToDivPixel(this.latlng);this.div_.style.width=this.width_+"px";this.div_.style.left=(divPixel.x)+"px"
this.div_.style.height=(this.height_)+"px";this.div_.style.top=(divPixel.y)-this.height_+"px";};PanoramioMarker.prototype.getZIndex=function(m){return GOverlay.getZIndex(marker.getPoint().lat());}
PanoramioMarker.prototype.getPoint=function(){return this.latlng;};function PAMarkerInfowindow(opts){this.latlng=opts.latlng;if(!opts)opts={};this.offsetVertical_=-75;this.offsetHorizontal_=-40;this.height_=80;this.width_=80;this.pa_information_=opts.pa_information;}
PAMarkerInfowindow.prototype=new GOverlay();PAMarkerInfowindow.prototype.initialize=function(map){var me=this;var div=document.createElement("div");div.style.border="0px none";div.style.position="absolute";div.style.visibility="visible";div.style.background="url('../images/icons/marker.png') no-repeat 0 0";div.style.width=this.width_+"px";div.style.height=this.height_+"px";var paImage=document.createElement("img");paImage.style.position="absolute";paImage.style.top='13px';paImage.style.left='16px';paImage.style.width="48px";paImage.style.height="48px";paImage.style.cursor="pointer";paImage.src=this.pa_information_.image;div.appendChild(paImage);var hiddenDiv=document.createElement('div');hiddenDiv.style.position="absolute";hiddenDiv.style.display='none';hiddenDiv.style.top='-7px';hiddenDiv.style.left='-5px';hiddenDiv.style.width="208px";hiddenDiv.style.height="88px";hiddenDiv.style.background='url(../images/markers/backgroundMarker.png) no-repeat 0 0';hiddenDiv.style.cursor="pointer";hiddenDiv.alt=this.pa_information_.slug;var paImageOver=document.createElement("img");paImageOver.style.position="absolute";paImageOver.style.top='19px';paImageOver.style.left='20px';paImageOver.style.width="48px";paImageOver.style.height="48px";paImageOver.style.cursor="pointer";paImageOver.style.border='1px solid #005783'
paImageOver.src=this.pa_information_.image;hiddenDiv.appendChild(paImageOver);var paName=document.createElement('p');paName.style.position="relative";paName.style.float="left";paName.style.padding='18px 0 0 76px';paName.style.font='bold 12px Arial';paName.style.color='#FFFFFF';if(this.pa_information_.name!=null){var paNameLength=this.pa_information_.name.length;if(paNameLength>28){var paNameValue=this.pa_information_.name.substring(0,22);$(paName).html(paNameValue+'...');}else{$(paName).html(this.pa_information_.name);}}
paName.style.width="112px";paName.style.cursor="pointer";hiddenDiv.appendChild(paName);$(hiddenDiv).click(function(ev){if(!onDragMovement){window.location='/sites/'+$(this).attr('alt');}else{onDragMovement=false;}
ev.stopPropagation();ev.preventDefault();});var localName=document.createElement('p');localName.style.position="relative";localName.style.float="left";localName.style.margin='0 0 0 76px';localName.style.font='italic 11px Arial';localName.style.color='#FFFFFF';if(this.pa_information_.local_name!=null){var localNameLength=this.pa_information_.local_name.length;if(localNameLength>16){var localNameValue=this.pa_information_.local_name.substring(0,16);$(localName).html(localNameValue+'...');}else{$(localName).html(this.pa_information_.local_name);}}
localName.style.width="112px";localName.style.cursor="pointer";hiddenDiv.appendChild(localName);var poI=document.createElement('p');poI.style.position="absolute";poI.style.float="left";poI.style.bottom='18px';poI.style.left='76px';poI.style.font='normal 10px Arial';poI.style.color='#004669';if(this.pa_information_.poi_count>0){if(this.pa_information_.poi_count==1){$(poI).html(this.pa_information_.poi_count+' Point of interest');}else{$(poI).html(this.pa_information_.poi_count+' Points of interest');}}else{$(poI).html('');}
poI.style.width="112px";poI.style.cursor="pointer";hiddenDiv.appendChild(poI);div.appendChild(hiddenDiv);GEvent.addDomListener(div,"mouseover",function(event){$(this).children('div').stop().fadeTo('fast',1);});GEvent.addDomListener(hiddenDiv,"mouseout",function(event){$(this).stop().fadeTo("fast",0);});map.getPane(G_MAP_FLOAT_PANE).appendChild(div);this.map_=map;this.div_=div;};PAMarkerInfowindow.prototype.remove=function(){this.div_.parentNode.removeChild(this.div_);};PAMarkerInfowindow.prototype.copy=function(){var opts={};opts.latlng=this.latlng;opts.pa_information_=this.pa_information_;return new PAMarkerInfowindow(opts);};PAMarkerInfowindow.prototype.redraw=function(force){if(!force)return;var divPixel=this.map_.fromLatLngToDivPixel(this.latlng);this.div_.style.width=this.width_+"px";this.div_.style.left=(divPixel.x)+this.offsetHorizontal_+"px";this.div_.style.height=(this.height_)+"px";this.div_.style.top=(divPixel.y)+this.offsetVertical_+"px";};PAMarkerInfowindow.prototype.getZIndex=function(m){return GOverlay.getZIndex(marker.getPoint().lat());}
PAMarkerInfowindow.prototype.getPoint=function(){return this.latlng;};function PAMarker(opts){this.latlng=opts.latlng;if(!opts)opts={};this.offsetVertical_=-75;this.offsetHorizontal_=-40;this.height_=80;this.width_=80;this.pa_information_=opts.pa_information;}
PAMarker.prototype=new GOverlay();PAMarker.prototype.initialize=function(map){var me=this;var div=document.createElement("div");div.style.border="0px none";div.style.position="absolute";div.style.visibility="visible";div.style.background="url('../images/icons/marker.png') no-repeat 0 0";div.style.width=this.width_+"px";div.style.height=this.height_+"px";var paImage=document.createElement("img");paImage.style.position="absolute";paImage.style.top='13px';paImage.style.left='16px';paImage.style.width="48px";paImage.style.height="48px";paImage.src=this.pa_information_.image;div.appendChild(paImage);GEvent.addDomListener(div,"mouseover",function(event){$(this).css('z-index',global_index+1);global_index++;});map.getPane(G_MAP_FLOAT_PANE).appendChild(div);this.map_=map;this.div_=div;};PAMarker.prototype.remove=function(){this.div_.parentNode.removeChild(this.div_);};PAMarker.prototype.copy=function(){var opts={};opts.latlng=this.latlng;opts.pa_information_=this.pa_information_;return new PAMarker(opts);};PAMarker.prototype.redraw=function(force){if(!force)return;var divPixel=this.map_.fromLatLngToDivPixel(this.latlng);this.div_.style.width=this.width_+"px";this.div_.style.left=(divPixel.x)+this.offsetHorizontal_+"px";this.div_.style.height=(this.height_)+"px";this.div_.style.top=(divPixel.y)+this.offsetVertical_+"px";};PAMarker.prototype.getZIndex=function(m){return GOverlay.getZIndex(marker.getPoint().lat());}
PAMarker.prototype.getPoint=function(){return this.latlng;};function POIMarker(opts){this.latlng=opts.latlng;if(!opts)opts={};this.offsetVertical_=-18;this.offsetHorizontal_=-18;this.height_=37;this.width_=37;this.poi_information_=opts.poi_information;}
POIMarker.prototype=new GOverlay();POIMarker.prototype.initialize=function(map){var me=this;var div=document.createElement("div");div.style.border="0px none";div.style.position="absolute";div.style.background="url('/images/sites/poiMarker.png') no-repeat 0 0";div.style.width="37px";div.style.height="37px";div.style.cursor='pointer';var hiddenDiv=document.createElement('div');hiddenDiv.style.position="absolute";hiddenDiv.style.display='none';hiddenDiv.style.top='-30px';hiddenDiv.style.left='-42px';hiddenDiv.style.width='120px';hiddenDiv.style.background='none';hiddenDiv.alt=this.poi_information_.slug;var arrow=document.createElement("img");arrow.style.position="absolute";arrow.style.bottom='-8px';arrow.style.left='52px';arrow.style.width="16px";arrow.style.height="8px";arrow.style.border='none';arrow.src='/images/sites/arrow_tooltip.png';hiddenDiv.appendChild(arrow);var poi_name=document.createElement('p');poi_name.style.padding='4px 1px';poi_name.style.font='bold 11px Arial';poi_name.style.color='#FFFFFF';poi_name.style.background="url('/images/sites/bkg_tooltip.png') repeat-x 0 0";$(poi_name).css('text-align','center');var poiNameLength=this.poi_information_.title.length;if(poiNameLength>16){var poiNameValue=this.poi_information_.title.substring(0,16);$(poi_name).html(poiNameValue+'...');}else{$(poi_name).html(this.poi_information_.title);}
hiddenDiv.appendChild(poi_name);div.appendChild(hiddenDiv);GEvent.addDomListener(div,"mouseover",function(event){$(this).css('z-index',global_index+1);global_index++;$(this).children('div').show();$(this).children('div').hover(function(ev){$(this).hide();});});GEvent.addDomListener(div,"mouseout",function(event){$(this).children('div').hide();});map.getPane(G_MAP_MARKER_PANE).appendChild(div);this.map_=map;this.div_=div;};POIMarker.prototype.remove=function(){this.div_.parentNode.removeChild(this.div_);};POIMarker.prototype.copy=function(){var opts={};opts.latlng=this.latlng;opts.poi_information_=this.poi_information_;return new POIMarker(opts);};POIMarker.prototype.redraw=function(force){if(!force)return;var divPixel=this.map_.fromLatLngToDivPixel(this.latlng);this.div_.style.width=this.width_+"px";this.div_.style.left=(divPixel.x)+"px"
this.div_.style.height=(this.height_)+"px";this.div_.style.top=(divPixel.y)-this.height_+"px";};POIMarker.prototype.getZIndex=function(m){return GOverlay.getZIndex(marker.getPoint().lat());}
POIMarker.prototype.getPoint=function(){return this.latlng;};var map;var biodiversity_map;var ppeOverlay;var paOverlay;var clickedLat;var paDictionary=new Object();var onDragMovement=false;var siteId;var global_index=1000;var lastMask=500;var click_event;var click_panoramio_marker=true;var pa_center;var markers_array=[];var pois_icon;var pa_zoom;var panoramio_icon;var tilelayer;var tilelayer_pa;$(document).ready(function(){var height_content=$('div#upper_area div.content').height();$('a#zoom_in').css('top',height_content+15+'px');$('a#zoom_out').css('top',height_content+15+'px');$('a#terrain').css('top',height_content+15+'px');$('a#satellite').css('top',height_content+15+'px');$('a#hide_markers').css('top',height_content+15+'px');$('a#zoom_in').fadeIn();$('a#zoom_out').fadeIn();$('a#terrain').fadeIn();$('a#satellite').fadeIn();$('a#hide_markers').fadeIn();$('a.edit_map_button').fadeIn();$('a#zoom_in').click(function(ev){ev.stopPropagation();ev.preventDefault();map.setZoom(map.getZoom()+1);});$('a#zoom_out').click(function(ev){ev.stopPropagation();ev.preventDefault();map.setZoom(map.getZoom()-1);});$('a#zoomin_biodiversity').click(function(ev){ev.stopPropagation();ev.preventDefault();biodiversity_map.setZoom(biodiversity_map.getZoom()+1);});$('a#zoomout_biodiversity').click(function(ev){ev.stopPropagation();ev.preventDefault();biodiversity_map.setZoom(biodiversity_map.getZoom()-1);});$('a#satellite').click(function(ev){ev.stopPropagation();ev.preventDefault();if(!$(this).hasClass('selected')){$('a#terrain').removeClass('selected');$('a#satellite').addClass('selected');map.setMapType(G_SATELLITE_MAP);}});$('a#hide_markers').click(function(ev){ev.stopPropagation();ev.preventDefault();if(!$(this).hasClass('disabled')){if($(this).hasClass('selected')){$(this).removeClass('selected');displayLoading();show_markers();}else{$(this).addClass('selected');displayLoading();clear_markers();}}});$('a#terrain').click(function(ev){ev.stopPropagation();ev.preventDefault();if(!$(this).hasClass('selected')){$('a#satellite').removeClass('selected');$('a#terrain').addClass('selected');map.setMapType(G_PHYSICAL_MAP);}});$('a#terrain').addClass('selected');if(GBrowserIsCompatible()){map=new GMap2(document.getElementById("js_map"));map.setMapType(G_PHYSICAL_MAP);biodiversity_map=new GMap2(document.getElementById("biodiversity_map"));biodiversity_map.setMapType(G_PHYSICAL_MAP);biodiversity_map.disableDragging();biodiversity_map.disableDoubleClickZoom();}
function setSearchButton(mapState){if(mapState=="false"){$("#button_map").html('show map');$("#button_map").css('background','url("../images/icons/double_arrow.gif") no-repeat left 2px');}else{$("#button_map").html('hide map');$("#button_map").css('background','url("../images/icons/double_arrow.gif") no-repeat left -11px');}}
$('#toogle_size_map').click(function(ev){ev.stopPropagation();ev.preventDefault();var map_height;var maximize=false;if($("#toogle_size_map").text()=='expand'){$("#toogle_size_map").html('close');$("#toogle_size_map").css('background','url("../images/icons/double_arrow.gif") no-repeat 8px -11px');$("#toogle_size_map").css('padding','0 0 0 21px');map_height=500;maximize=true;map.setZoom(map.getZoom()+1);}else{$("#toogle_size_map").html('expand');$("#toogle_size_map").css('background','url("../images/icons/double_arrow.gif") no-repeat 5px 2px');$("#toogle_size_map").css('padding','0 0 0 18px');map_height=306;map.setZoom(map.getZoom()-1);}
$('div.pa_map').stop().animate({height:map_height},500,'',refreshGoogleMapsSize);});function refreshGoogleMapsSize(){map.checkResize();map.setCenter(pa_center);}
function getSearchHeight(mapState){return((mapState=="true")?305:$('#advanced_search_box').height()+68);}
function setSearchMap(mapState){map_height=getSearchHeight(mapState);var userAgent=navigator.userAgent.toLowerCase();if(/mozilla/.test(userAgent)&&!/(compatible|webkit)/.test(userAgent)){$('div.flash_container').height(map_height);}else{$('div.flash_container').stop().animate({height:map_height},200);}}
siteId=$('#pa_map_json_link').attr('href');var url_request="/api/site/"+$('#pa_map_json_link').attr('href')+"/json";var script=document.createElement('script');script.setAttribute('src',url_request+'?callback=loadJson');script.setAttribute('id','jsonScript');script.setAttribute('type','text/javascript');document.documentElement.firstChild.appendChild(script);GEvent.addListener(map,"click",function(overlay,latLng){setTimeout(function(){if(click_panoramio_marker){clickedLat=latLng;getData(latLng);}},50);});});function getBBox(x,y,zoom){var lon=-180;var lonWidth=360;var lat=-1;var latHeight=2;var tilesAtThisZoom=(1<<zoom);lonWidth=360.0/tilesAtThisZoom;lon=-180+(x*lonWidth);latHeight=2.0/tilesAtThisZoom;lat=((tilesAtThisZoom/2-y-1)*latHeight);latHeight+=lat;latHeight=(2*Math.atan(Math.exp(Math.PI*latHeight)))-(Math.PI/2);latHeight*=(180/Math.PI);lat=(2*Math.atan(Math.exp(Math.PI*lat)))-(Math.PI/2);lat*=(180/Math.PI);latHeight-=lat;if(lonWidth<0){lon=lon+lonWidth;lonWidth=-lonWidth;}
if(latHeight<0){lat=lat+latHeight;latHeight=-latHeight;}
return lon+","+lat+","+(lon+lonWidth)+","+(lat+latHeight);}
function getData(latlng){var script=document.createElement('script');script.setAttribute('src',BASE_APP_URL+'/api/sites_by_point/'+latlng.lng()+'/'+latlng.lat()+'?callback=loadClickedJson');script.setAttribute('id','json2Script');script.setAttribute('type','text/javascript');document.documentElement.firstChild.appendChild(script);displayLoading();}
function loadClickedJson(json){if(json.length>0){var id=json[0].id;for(var i in json){if(belongToMap(json[i].id)){hideLoading();return;}}
var infoBox=new PAMarkerInfowindow({latlng:clickedLat,pa_information:json[0]});map.addOverlay(infoBox);paDictionary[id]=infoBox;}
hideLoading();}
function loadJson(json){var bounds=new GLatLngBounds();var empty_pois=false;bounds.extend(new GLatLng(json.bbox[0].y,json.bbox[0].x));bounds.extend(new GLatLng(json.bbox[2].y,json.bbox[2].x));pa_center=bounds.getCenter();map.setCenter(pa_center,map.getBoundsZoomLevel(bounds));biodiversity_map.setCenter(pa_center,biodiversity_map.getBoundsZoomLevel(bounds));pois_icon=new GIcon(false,'/images/sites/poiMarker.png');pois_icon.iconSize=new GSize(37,37);pois_icon.iconAnchor=new GPoint(19,19);panoramio_icon=new GIcon(true,'/images/sites/panoramio-marker.png');panoramio_icon.iconSize=new GSize(18,18);panoramio_icon.iconAnchor=new GPoint(9,9);if(json.pois.length>0){for(var im=0;im<json.pois.length;im++){var poi_information=new Object();poi_information.title=json.pois[im].name;var pois_marker=new POIMarker({latlng:new google.maps.LatLng(json.pois[im].y,json.pois[im].x),map:map,poi_information:poi_information});map.addOverlay(pois_marker);markers_array.push(pois_marker);}}else{empty_pois=true;}
if(json.pictures!=null&&json.pictures.length>1){for(var im=0;im<json.pictures.length;im++){var image_information=new Object();image_information.url=json.pictures[im].url;image_information.photo_url=json.pictures[im].photo_url;image_information.width=json.pictures[im].width;image_information.height=json.pictures[im].height;var images_marker=new PanoramioMarker({latlng:new google.maps.LatLng(json.pictures[im].y,json.pictures[im].x),image_information:image_information});map.addOverlay(images_marker);markers_array.push(images_marker);}
var pa_information=new Object();pa_information.image=json.pictures[0].url;var site_marker=new PAMarker({latlng:new google.maps.LatLng(json.pictures[0].y,json.pictures[0].x),pa_information:pa_information});map.addOverlay(site_marker);paDictionary[$('#pa_map_json_link').attr('href')]=site_marker;markers_array.push(site_marker);}else{if(empty_pois){$('a#hide_markers').addClass('disabled');}}
var copy_wcmc=new GCopyrightCollection("g");copy_wcmc.addCopyright(new GCopyright('Demo',new GLatLngBounds(new GLatLng(-90,-180),new GLatLng(90,180)),0,'2010 UNEP-WCMC'));tilelayer=new GTileLayer(copy_wcmc);tilelayer.getTileUrl=function(xy,z){return UTILITY_SERVER_URL+"/blue/"+z+"/"+xy.x+"/"+xy.y;};tilelayer.isPng=function(){return true;};tilelayer.getOpacity=function(){return 1.0;}
ppeOverlay=new GTileLayerOverlay(tilelayer);map.addOverlay(ppeOverlay);var copy_gbif=new GCopyrightCollection("©");copy_gbif.addCopyright(new GCopyright(' ',new GLatLngBounds(new GLatLng(-90,-180),new GLatLng(90,180)),0,' '));var tilelayer_gbif=new GTileLayer(copy_gbif);tilelayer_gbif.getTileUrl=function(xy,z){return GBIF_DENSITY_URL+"?tile="+xy.x+"_"+xy.y+"_"+z+"_13140803";};tilelayer_gbif.isPng=function(){return true;};tilelayer_gbif.getOpacity=function(){return 1.0;}
var gbif_overlay=new GTileLayerOverlay(tilelayer_gbif);biodiversity_map.addOverlay(gbif_overlay);tilelayer_pa=new GTileLayer(copy_wcmc);tilelayer_pa.getTileUrl=function(xy,z){return UTILITY_SERVER_URL+"/orange/"+siteId+"/"+z+"/"+xy.x+"/"+xy.y;};tilelayer_pa.isPng=function(){return true;};tilelayer_pa.getOpacity=function(){return 1.0;}
paOverlay=new GTileLayerOverlay(tilelayer_pa);map.addOverlay(paOverlay);hideLoading();}
function orderOfCreation(marker,b){return 1;}
function displayLoading(){$('#loadingPa').fadeIn('fast');}
function hideLoading(){$('#loadingPa').fadeOut('fast');}
function belongToMap(_paID){for(var i in paDictionary){if(i==_paID||_paID==siteId){return true;}}
return false;}
function clear_markers(){if(markers_array){for(var i=0;i<markers_array.length;i++){map.removeOverlay(markers_array[i]);}
hideLoading();}}
function show_markers(){if(markers_array){for(var i=0;i<markers_array.length;i++){map.addOverlay(markers_array[i]);}
hideLoading();}}
function refreshLayers(){tilelayer.getTileUrl=function(xy,z){return UTILITY_SERVER_URL+"/blue/"+z+"/"+xy.x+"/"+xy.y+"?v="+((Math.random(1)*100).toFixed(0));};ppeOverlay.refresh();tilelayer_pa.getTileUrl=function(xy,z){return UTILITY_SERVER_URL+"/orange/"+siteId+"/"+z+"/"+xy.x+"/"+xy.y+"?v="+((Math.random(1)*100).toFixed(0));};paOverlay.refresh();}
var map_changed=0;var edit_map;var loadedGeoJson;var activePolygons;var copyActivePolygons;var previousActivePolygons;var vertexDelMarkers=[];var deleteMarkers;var origPaBBox;var parsedBounds;var listeners=[];var iconDel;var COLORS=[["red","#ff0000"],["orange","#ff8800"],["green","#008000"],             ["blue","#000080"],["purple","#800080"]];var options={};var lineCounter_=0;var shapeCounter_=0;var markerCounter_=0;var colorIndex_=0;var featureTable_;var textInputSource;$(document).ready(function(){textInputSource=$('#citationInput').attr('value');$('a#edit_map_button_ban').click(function(ev){ev.stopPropagation();ev.preventDefault();$('div#signUp').fadeIn('fast');$.scrollTo('div#header',500,function(){$('#username_field_home').focus();$('div.login_tooltip').fadeIn('fast').delay(2000).fadeOut('slow');});});$('#citationInput').click(function(ev){ev.stopPropagation();ev.preventDefault();if($(this).attr('value')==textInputSource)
$(this).attr('value','');});$('a#edit_map_button').click(function(ev){ev.stopPropagation();ev.preventDefault();var height_mamufas=$(document).height();var width_mamufas=$(document).width();$('div#mamufas').css('height',height_mamufas+'px');$('div#mamufas').css('width',width_mamufas+'px');var map_position=$('div.pa_map').offset();if(map_position==null){map_position=$('div.admin_pa_map').offset();}
var zooms_position=$('a#zoom_in').offset();var map_type_position=$('a#satellite').position();$('div#mamufas').fadeIn('fast',function(ev){$.scrollTo('div.content',300,function(ev){$('div.geometry_container').css('left','0');$('div.geometry_container').css('top',(map_position.top)+'px');$('div.geometry_container').fadeIn('fast');$('a#zoom_in_geometry').fadeIn();$('a#zoom_out_geometry').fadeIn();$('a#terrain_geometry').fadeIn();$('a#satellite_geometry').fadeIn();$('a#terrain_geometry').addClass('selected');$('a#edit_polygon').addClass('selected');$('a#remove_polygon').removeClass('selected');$('a#draw_polygon').removeClass('selected');$('a#remove_vertex').removeClass('selected');init();});});});$('a#cancel_editing').click(function(ev){ev.stopPropagation();ev.preventDefault();if(map_changed==1){$('div.tools_container div.exit_without_save').show();}
else{$('div#mamufas').fadeOut();$('div.geometry_container').fadeOut();}});$('a#ok_exit_edit_map').click(function(ev){$('div.tools_container div.exit_without_save').fadeOut();$('div#mamufas').fadeOut();$('div.geometry_container').fadeOut();});$('a#cancel_exit_edit_map').click(function(ev){ev.stopPropagation();ev.preventDefault();$('div.tools_container div.exit_without_save').fadeOut();});$('a#cancel_window_edit').click(function(ev){ev.stopPropagation();ev.preventDefault();hideLoader();$('div#mamufas').fadeOut();$('div.geometry_container').fadeOut();});$('a#zoom_in_geometry').click(function(ev){ev.stopPropagation();ev.preventDefault();edit_map.setZoom(edit_map.getZoom()+1);});$('a#zoom_out_geometry').click(function(ev){ev.stopPropagation();ev.preventDefault();edit_map.setZoom(edit_map.getZoom()-1);});$('a#terrain_geometry').click(function(ev){ev.stopPropagation();ev.preventDefault();if(!$(this).hasClass('selected')){$('a#satellite_geometry').removeClass('selected');$('a#terrain_geometry').addClass('selected');edit_map.setMapType(G_PHYSICAL_MAP);}});$('a#satellite_geometry').click(function(ev){ev.stopPropagation();ev.preventDefault();if(!$(this).hasClass('selected')){$('a#terrain_geometry').removeClass('selected');$('a#satellite_geometry').addClass('selected');edit_map.setMapType(G_SATELLITE_MAP);}});$('a#edit_polygon').click(function(ev){ev.stopPropagation();ev.preventDefault();if(!$(this).hasClass('selected')){$('a#remove_polygon').removeClass('selected');$('a#draw_polygon').removeClass('selected');$('a#remove_vertex').removeClass('selected');$('a#edit_polygon').addClass('selected');enterEditMode();}});$('a#remove_vertex').click(function(ev){ev.stopPropagation();ev.preventDefault();if(!$(this).hasClass('selected')){$('a#remove_polygon').removeClass('selected');$('a#draw_polygon').removeClass('selected');$('a#remove_vertex').addClass('selected');$('a#edit_polygon').removeClass('selected');enterVertexDel();}});$('a#draw_polygon').click(function(ev){ev.stopPropagation();ev.preventDefault();if(!$(this).hasClass('selected')){$('a#remove_polygon').removeClass('selected');$('a#draw_polygon').addClass('selected');$('a#remove_vertex').removeClass('selected');$('a#edit_polygon').removeClass('selected');enterPolygonAdd();}});$('a#remove_polygon').click(function(ev){ev.stopPropagation();ev.preventDefault();if(!$(this).hasClass('selected')&&!$(this).hasClass('disabled')){$('a#remove_polygon').addClass('selected');$('a#draw_polygon').removeClass('selected');$('a#remove_vertex').removeClass('selected');$('a#edit_polygon').removeClass('selected');enterPolygonDel();}});$('a#undo_editing').click(function(ev){ev.stopPropagation();ev.preventDefault();undo();});$('a#done_geometry').click(function(ev){ev.stopPropagation();ev.preventDefault();showLoader();onDoneClick();});$('a#skip_edit_window').click(function(ev){ev.stopPropagation();ev.preventDefault();$('#citationInput').attr('value',textInputSource);showLoader();});$('div#errors_geo_tool a').click(function(ev){ev.stopPropagation();ev.preventDefault();hideLoader();});});function getColor(named){return"#fe6905#";}
function enterVertexDel(){clearListeners();deleteMarkers=new Object();_.each(activePolygons,function(pol){var vertexIcon=new GIcon(false,'/images/sites/delete_vertex_noover.png');vertexIcon.iconSize=new GSize(12,12);vertexIcon.iconAnchor=new GPoint(6,6);var vertCount=pol.getVertexCount();for(var i=0;i<vertCount;i++){var ma=new GMarker(pol.getVertex(i),{icon:vertexIcon});deleteMarkers[pol.getVertex(i).toUrlValue()]=ma;listeners.push(GEvent.addListener(ma,"mouseover",function(){this.setImage('/images/sites/delete_vertex.png');}));listeners.push(GEvent.addListener(ma,"mouseout",function(){this.setImage('/images/sites/delete_vertex_noover.png');}));listeners.push(GEvent.addListener(ma,"click",function(){var vertCount=pol.getVertexCount();for(var i=0;i<vertCount;i++){if(this.getLatLng().equals(pol.getVertex(i))){pol.deleteVertex(i);edit_map.removeOverlay(deleteMarkers[this.getLatLng().toUrlValue()]);break;}}}));edit_map.addOverlay(ma);vertexDelMarkers.push(ma);}});}
function enterPolygonDel(){clearListeners();if(activePolygons.length>1){_.each(activePolygons,function(pol){listeners.push(GEvent.addListener(pol,"click",function(){if(activePolygons.length>1){map_changed=1;pol.toberemoved=true;activePolygons=_.reject(activePolygons,function(poly){return poly.toberemoved==true});edit_map.removeOverlay(pol);}}));listeners.push(GEvent.addListener(pol,"mouseover",function(){pol.setStrokeStyle({color:"#00FF33"});pol.setFillStyle({color:"#00FF33"});}));listeners.push(GEvent.addListener(pol,"mouseout",function(){pol.setStrokeStyle({color:getColor(false)});pol.setFillStyle({color:getColor(false)});}));});}}
function enterPolygonAdd(){clearListeners();var poly=new GPolygon([],getColor(false),2,0.7,getColor(false),0.2);edit_map.addOverlay(poly);poly.enableDrawing();poly.enableEditing();GEvent.addListener(poly,"endline",function(){if(activePolygons.lenghth>1){$('a#remove_polygon').removeClass('disabled');}
GEvent.bind(poly,"lineupdated",null,function(){if(activePolygons.lenghth>1){$('a#remove_polygon').removeClass('disabled');}
map_changed=1;});activePolygons.push(poly);enterEditMode();$('a#draw_polygon').removeClass('selected');$('a#edit_polygon').addClass('selected');});}
function enterEditMode(){clearListeners();if(activePolygons.lenghth>1){$('a#remove_polygon').removeClass('disabled');}
_.each(activePolygons,function(pol){pol.enableEditing();listeners.push(GEvent.addListener(pol,"lineupdated",function(){map_changed=1;}));});}
function clearListeners(){if(activePolygons.length>1){$('a#remove_polygon').removeClass('disabled');}else{$('a#remove_polygon').addClass('disabled');}
_.each(listeners,function(eventListener){GEvent.removeListener(eventListener);});listeners=[];_.each(activePolygons,function(pol){pol.disableEditing();});_.each(vertexDelMarkers,function(ma){edit_map.removeOverlay(ma);vertexDelMarkers=[];});}
function init(){if(activePolygons!=null){edit_map.clearOverlays();}
if($("a#is_pa_editable").text()=="true"){showLoader();var url="/sites/"+siteId+"/protected_areas/geom";$.ajax({url:url,type:"GET",dataType:'jsonp',success:function(data){loadedGeoJson=data.the_geom;initialize_geometry();},error:function(XMLHttpRequest,textStatus,errorThrown){alert('Sorry there has been an error while contacting the server, please refresh page.');}});}else{displayNonEditableWindow();}}
function displayNonEditableWindow(){}
function initialize_geometry(){if(GBrowserIsCompatible()){if(activePolygons==null){edit_map=new GMap2(document.getElementById("geometry_map"));}
edit_map.setCenter(pa_center,pa_zoom);edit_map.checkResize();parsedBounds=new GLatLngBounds();activePolygons=geoJson2Polys(loadedGeoJson,parsedBounds);var z=edit_map.getBoundsZoomLevel(parsedBounds);edit_map.setCenter(parsedBounds.getCenter(),edit_map.getBoundsZoomLevel(parsedBounds));origPaBBox=parsedBounds;_.each(activePolygons,function(pol){edit_map.addOverlay(pol);});enterEditMode();hideLoader();}}
function geoJson2Polys(areajson,bounds){var coords=areajson.coordinates;var polygons=_(coords).reduce([],function(memo_n,n){var polygonpaths=_(n).reduce([],function(memo_o,o){var polygoncords=_(o).reduce([],function(memo_p,p){var mylatlng=new GLatLng(p[1],p[0]);if(bounds){bounds.extend(mylatlng);}
memo_p.push(mylatlng);return memo_p;});memo_o.push(polygoncords);return memo_o;});var _polygon=new GPolygon(polygonpaths[0],getColor(false),2,0.7,getColor(false),0.2);memo_n.push(_polygon);return memo_n;});return polygons;}
function polys2geoJson(polygons){var geojson={"type":"MultiPolygon"};var polys=[];_.each(polygons,function(pol){var poly=[];var path=[];var numPoints=pol.getVertexCount();for(var i=0;i<numPoints;i++){var lat=pol.getVertex(i).lat();var lng=pol.getVertex(i).lng();path.push([lng,lat]);}
poly.push(path);polys.push(poly);});geojson['coordinates']=polys;return $.toJSON(geojson);}
function onDoneClick(){var url="/sites/"+siteId+"/protected_areas/validate";$.ajax({url:url,type:"POST",data:{the_geom:polys2geoJson(activePolygons)},dataType:'jsonp',success:function(data){if(data.errors.length>0){displayErrorsWindow(data.errors);}else{map_changed=0;refreshLayers();displayCitationWindow();}},error:function(XMLHttpRequest,textStatus,errorThrown){alert('Sorry there has been an error while contacting the server, please refresh page.');}});}
function saveGeomChanges(has_citation){showLoader();_.each(activePolygons,function(pol){var pb=pol.getBounds();origPaBBox.extend(pb.getSouthWest());origPaBBox.extend(pb.getNorthEast());});var bbox=origPaBBox.getSouthWest().lng()+","+origPaBBox.getSouthWest().lat()
+","+origPaBBox.getNorthEast().lng()+","+origPaBBox.getNorthEast().lat();var url="/sites/"+siteId+"/protected_areas/update";json_data={bbox_to_invalid:bbox,the_geom:polys2geoJson(activePolygons)};if(has_citation){json_data['citation']=$('#citationInput').attr('value')}
$.ajax({url:url+".json",type:"POST",data:json_data,dataType:'jsonp',success:function(data){if(data.errors.length>0){displayErrorsWindow(data.errors);}else{closeEditingToolWindow();$("div.geometry_container").fadeOut(function(){$("div#mamufas").fadeOut();});refreshLayers();}},error:function(XMLHttpRequest,textStatus,errorThrown){alert('Sorry there has been an error while contacting the server, please refresh page.');}});}
function showLoader(){$('div.loader img').show();$('div#errors_geo_tool').hide();$('div#not_editable_geo').hide();$('div#editing_modal_window').hide();$('div.loader').fadeIn();}
function displayCitationWindow(){$('div.loader img').hide();$('div#errors_geo_tool').hide();$('div#not_editable_geo').hide();var loader_position=$('div.loader').offset();var wscr=$(window).width();var mleft=(wscr-510)/2;$('div#editing_modal_window').css('left',(mleft)+'px');$('div#editing_modal_window').css('top',(loader_position.top)+70+'px');$('div#editing_modal_window').show();$('div.loader').fadeIn();}
function displayErrorsWindow(errors){$('div#errors_geo_tool ul').html('');for(var i=0;i<errors.length;i++){var li_html='<li>';li_html+=errors[0];li_html+='</li>';$('div#errors_geo_tool ul').append(li_html);}
$('div.loader img').hide();$('div#not_editable_geo').hide();$('div#editing_modal_window').hide();var loader_position=$('div.loader').offset();var wscr=$(window).width();var mleft=(wscr-470)/2;$('div#errors_geo_tool').css('left',(mleft)+'px');$('div#errors_geo_tool').css('top',(loader_position.top)+100+'px');$('div#errors_geo_tool').show();$('div.loader').fadeIn();}
function displayNonEditableWindow(){$('div.loader img').hide();$('div#errors_geo_tool').hide();$('div#editing_modal_window').hide();var loader_position=$('div.loader').offset();var wscr=$(window).width();var mleft=(wscr-510)/2;$('div#not_editable_geo').css('left',(mleft)+'px');$('div#not_editable_geo').css('top',(loader_position.top)+70+'px');$('div#not_editable_geo').show();$('div.loader').fadeIn();}
function hideLoader(){$('div.loader').fadeOut();$('div#errors_geo_tool').hide();$('div#not_editable_geo').hide();$('div#editing_modal_window').hide();}
function closeEditingToolWindow(){$('div.loader img').show();$('div#errors_geo_tool').hide();$('div#not_editable_geo').hide();$('div#editing_modal_window').hide();$('div.loader').hide();}
var editRecordsList;var editRecordsListCompressed;$(document).ready(function(){$('.myselectbox').selectbox();$('.abs_link').hoverIntent(function(ev){var more_box=$(this).siblings(".abs_text");position=$(this).offset();height=$(this).height();more_box.css("top",position.top+height);more_box.css("left",position.left);more_box.fadeIn("fast");},function(){$(this).siblings(".abs_text").delay(1000).fadeOut("normal");});$(".abs_text").mouseleave(function(){$(this).delay(1000).fadeOut("normal");});$(".abs_text").mouseover(function(){$(this).clearQueue();});$("div.pagination span.disabled").hide();$("#slider").easySlider({auto:false,continuous:true,numeric:true,speed:500,numericId:'controls'});$("#slider2").easySlider({auto:false,continuous:true,numeric:true,speed:500,numericId:'controls_img_site'});if($("div.pa_images").length>0){var link_flickr=$('a.flickr_button');$('a.flickr_button').remove();$('ol#controls_img_site').append(link_flickr);}
editRecordsList=$('div#right_container div.protected_area ul').height();$('div#right_container div.protected_area ul li .last').hide();editRecordsListCompressed=$('div#right_container div.protected_area ul').height();$('div#right_container div.protected_area ul').height(editRecordsListCompressed);var wikipediaHeight=$('div#left_container div.content_area div.wikipedia').height();var containerHeight=$('div#right_container div.protected_area').height();var imagesContainer=$('div.pa_images').height();if(wikipediaHeight>200){var containerHeight=$('div#right_container div.protected_area').height();var linkToWikipedia=$('div.content_area div.bottomWikipedia p a').attr('href');if(imagesContainer!=null){$('div#left_container div.content_area div.wikipedia').height(containerHeight-221);var wikipediaContent=$('div#left_container div.content_area div.wikipedia').html().substring(0,1200);$('div#left_container div.content_area div.wikipedia').html(wikipediaContent+'...'+' <a href="'+linkToWikipedia+'" target="_blank">read more</a>');}else{$('div#left_container div.content_area div.wikipedia').height(containerHeight-45);if(imagesContainer!=null){$('div#left_container div.content_area div.wikipedia').css('margin-top','0');}
var wikipediaContent=$('div#left_container div.content_area div.wikipedia').html().substring(0,1550);$('div#left_container div.content_area div.wikipedia').html(wikipediaContent+'...'+' <a href="'+linkToWikipedia+'" target="_blank">read more</a>');}}
$("#view_more").click(function(ev){var sizeContainer=$('div#right_container div.protected_area').height();if(sizeContainer<editRecordsList){$('div#right_container div.protected_area ul li .last').show();$('div#right_container div.protected_area ul').animate({height:editRecordsList},500);$('#view_more').css('background-position','40px -18px');$('#view_more').css('padding-left','50px');$('#view_more').text('close');}else{$('div#right_container div.protected_area ul').animate({height:editRecordsListCompressed},500,function(){$('div#right_container div.protected_area ul li .last').hide();});$('#view_more').css('background-position','24px 4px');$('#view_more').css('padding-left','36px');$('#view_more').text('view more');}});$('div#left_container div.content_area div.pa_images div').hover(function(){$(this).children('span.classified_container').stop(true).fadeTo("fast",1);},function(){$(this).children('span.classified_container').stop(true).fadeTo("normal",0);});$('span.classified_container span a').click(function(ev){ev.preventDefault();if(!$(this).hasClass('voted')&&!$(this).hasClass('discard')){var image_id=$(this).parent().parent().attr('id');if(image_id=='ban'){var position=$('a#loginLink').offset();$("div#signUp").css("left",position.left-185+"px");$("div#signUp").css("top",position.top-14+"px");$('div#signUp').fadeIn('fast');$.scrollTo('div#header',500,function(){$('#username_field_home').focus();$('div.login_tooltip').fadeIn('fast').delay(2000).fadeOut('slow');});}else{var get_class=$(this).attr('class');var obj=$(this).parent().parent().get(0);var pa_id=$('div.wikipedia').attr('id');var images_ids=[];$("span.classified_container").each(function(ev){images_ids.push($(this).attr('id'));});var url_request='/sites/'+pa_id+'/images/'+image_id+'/'+get_class;var text=$(this).text();if(get_class=='vote_up'){$(this).addClass('voted');var temp=text.substring(7,text.length-2);var count=parseInt(temp)+1;$(this).text('good ('+count+')');$(this).parent().children('a.vote_down').addClass('discard');}else{$(this).addClass('voted');var temp=text.substring(6,text.length-2);var count=parseInt(temp)+1;$(this).text('bad ('+count+')');$(this).parent().children('a.vote_up').addClass('discard');}
var url_request='/sites/'+pa_id+'/images/'+image_id+'/'+get_class;$.ajax({url:url_request,type:'POST',dataType:'json',data:{param:get_class},success:function(data){}});}}});function check_pa_images(data,image_id,image_ids){var object=new Object();$.each(data,function(key,value){alert(key+': '+value.id);});}
$('#bad_wiki_link').click(function(e){e.stopPropagation();e.preventDefault();$.post($(this).attr('href'),function(data){$('span#learn_more').html('Infomation take from Wikipedia. You voted <strong style="color:#ff104b">down</strong> this article');$.modal.close();});return(false);});$('#mark_wrong').click(function(e){e.stopPropagation();e.preventDefault();show_modal(510,330,'#wikipedia_url_description','url(../images/common/modal_wikipedia_bkg.png)');});$('#new_wiki_link').click(function(ev){ev.stopPropagation();ev.preventDefault();show_modal(510,330,'#wikipedia_url_description','');});$('#flickr_button').click(function(e){e.stopPropagation();e.preventDefault();show_modal(510,381,'#flickr_window','url(../images/sites/flickr_bkg.png)');});$('a#edit_map_button_no_edit').click(function(ev){console.log('entra');ev.stopPropagation();ev.preventDefault();show_modal(510,280,'#not_editable_geo','url(../images/sites/non_editable_bkg.png)');});$('.ban_download').click(function(e){e.stopPropagation();e.preventDefault();var position=$('a#loginLink').offset();$("div#signUp").css("left",position.left-185+"px");$("div#signUp").css("top",position.top-14+"px");$('div#signUp').fadeIn('fast');$.scrollTo('div#header',500,function(){$('#username_field_home').focus();$('div.login_tooltip').fadeIn('fast').delay(2000).fadeOut('slow');});});$('#ban_flickr').click(function(e){e.stopPropagation();e.preventDefault();var position=$('a#loginLink').offset();$("div#signUp").css("left",position.left-185+"px");$("div#signUp").css("top",position.top-14+"px");$('div#signUp').fadeIn('fast');$.scrollTo('div#header',500,function(){$('#username_field_home').focus();$('div.login_tooltip').fadeIn('fast').delay(2000).fadeOut('slow');});});$('#wikipedia_submit_images').click(function(e){show_modal(510,381,'#flickr_window','url(../images/sites/flickr_bkg.png)');});$('#ban_wikipedia_submit_images').click(function(e){e.stopPropagation();e.preventDefault();var position=$('a#loginLink').offset();$("div#signUp").css("left",position.left-185+"px");$("div#signUp").css("top",position.top-14+"px");$('div#signUp').fadeIn('fast');$.scrollTo('div#header',500,function(){$('#username_field_home').focus();$('div.login_tooltip').fadeIn('fast').delay(2000).fadeOut('slow');});});$('div.interestBox div.bottomData').click(function(ev){ev.stopPropagation();ev.preventDefault();var url=$(this).children("a").attr('href');window.open(url);});$('div.relatedBox div.bottomData').click(function(ev){ev.stopPropagation();ev.preventDefault();var url=$(this).children("a").attr('href');location.href=url;});$("div#right_container div.view_more").hover(function(ev){$('div#right_container div.protected_area').css('border-color','#254C72');},function(ev){$('div#right_container div.protected_area').css('border-color','#cccccc');});$("li .conflict").hover(function(ev){$(this).children('div.message').fadeIn();},function(ev){$(this).children('div.message').fadeOut();});$('.more_facet_link').hoverIntent(function(ev){var more_box=$(this).siblings(".more_facet_list");more_box.fadeIn("fast");},function(){$(this).siblings(".more_facet_list").delay(1000).fadeOut("normal");});$(".more_facet_list").mouseleave(function(){$(this).delay(1000).fadeOut("normal");});$(".more_facet_list").mouseover(function(){$(this).clearQueue();});$('a.classified_button').hover(function(ev){$(this).children("span").show();},function(){$(this).children("span").fadeOut("normal");});$('a.tipsy').tipsy({fade:true,gravity:'s'});$('a.tipsy_conflict').tipsy({fade:true,gravity:'s'});$('img.tipwhee').tipsy({fade:false,gravity:'e'});$('a.what_is_this').tipsy({fade:true,gravity:'s'});$('#mycarousel').jcarousel({initCallback:mycarousel_initCallback,buttonNextHTML:null,buttonPrevHTML:null,size:3,scroll:1,start:1,vertical:true});$('a#login_form_switch').click(function(){$('#login_form').toggle();$('#password_forget').toggle();});$('#edit_data_container div.data_edit div span a').hover(function(){$(this).children('div.tooltip').show();},function(){$(this).children('div.tooltip').hide();});$('#open_login_container').click(function(ev){ev.preventDefault();ev.stopPropagation();var position=$('a#loginLink').offset();$("div#signUp").css("left",position.left-185+"px");$("div#signUp").css("top",position.top-14+"px");$('div#signUp').fadeIn('fast');$.scrollTo('div#header',500,function(){$('#username_field_home').focus();$('div.login_tooltip').fadeIn('fast').delay(2000).fadeOut('slow');});});$('#open_edit_container').click(function(ev){ev.preventDefault();var height_mamufas=$(document).height();var width_mamufas=$(document).width();$('div#mamufas').css('height',height_mamufas+'px');$('div#mamufas').css('width',width_mamufas+'px');var position=$('div#right_container').position();$('div#mamufas').fadeIn('fast',function(ev){$.scrollTo('div#right_container',300,function(ev){$('#edit_data_container').css('left',position.left-10+'px');$('#edit_data_container').css('top',(position.top+20)+'px');$('#edit_data_container').fadeIn('fast');});});});$('#edit_close').click(function(ev){ev.preventDefault();});$('#cancel_close').click(function(ev){ev.preventDefault();$('#edit_data_container').fadeOut();$('#mamufas').fadeOut();});$('#cancel_window_edit').click(function(ev){ev.preventDefault();$.modal.close();$('#not_editable_geo').fadeOut();$('#mamufas').fadeOut();});$('div#left_container div.latest_from li div.opinion a').click(function(ev){if($(this).parent().parent().find('div.visible').is(':visible')){$(this).parent().parent().find('div.visible').hide();$(this).hover(function(){$(this).children('span.dif').css('background','url(/images/common/download_right.gif) no-repeat right -27px');$(this).children('span.dif').css('color','#333333');},function(){$(this).children('span.dif').css('background','url(/images/common/download_right.gif) no-repeat right 0');$(this).children('span.dif').css('color','#666666');})
ev.preventDefault();}else{$(this).parent().parent().find('div.visible').show();$(this).hover(function(){$(this).children('span.dif').css('background','url(/images/common/download_right.gif) no-repeat right -27px');$(this).children('span.dif').css('color','#333333');},function(){$(this).children('span.dif').css('background','url(/images/common/download_right.gif) no-repeat right -27px');$(this).children('span.dif').css('color','#333333');})
ev.preventDefault();}});});